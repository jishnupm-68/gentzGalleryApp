<%- include("../../views/partials/admin/header") %>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  .pagination {
    display: flex;
    justify-content: center;
  }

  .btn {
    /* Add your button styling here */
    margin: 0 5px;
    padding: 5px 10px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    text-decoration: none;
    color: #333;
  }

  .active {
    /* Add styles for the active page */

    color: #fff;
  }

  .btn:hover {
    /* Add styles for button hover state */
    background-color: #ddd;
  }

  .table-spacing th,
  .table-spacing td {
    padding-left: 80px; /* Adjust the value as needed for the desired spacing */
  }
</style>


<main>
  <section class="container " style="margin-left: 20%; padding-top: 5%;">
    <div class="content-header row">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="content-title card-title">Dashboard</h2>
      </div>
    </div>
    
    <div class="card mb-4">
      <header class="card-header">
        <div class="row gx-3">
          <div class="col-lg-2 col-6 col-md-3">
            <select 
              class="form-select btn-secondary"
              onchange="location.href='/admin/?day=' + this.value"
            >
            <option  value="">Report</option>
            <option value="salesDaily" >Daily</option>
              <option value="salesWeekly">Weekly</option>
              <option value="salesMonthly">Monthly</option>
              <option value="salesYearly">Yearly</option>
              <!-- <% if (!locals.salesToday) { %>

              <option value="salesToday" >salesToday</option>
              <option value="salesWeekly">salesWeekly</option>
              <option value="salesMonthly">salesMonthly</option>
              <option value="salesYearly">salesYearly</option> -->
              <!-- <% } else if (locals.salesWeekly) { %>
              <option value="salesWeekly" selected>salesWeekly</option>
              <option value="salesToday">salesToday</option>
              <option value="salesMonthly">salesMonthly</option>
              <option value="salesYearly">salesYearly</option>
              <% } else if (locals.salesMonthly) { %>
              <option value="salesMonthly" selected>salesMonthly</option>
              <option value="salesToday">salesToday</option>
              <option value="salesWeekly">salesWeekly</option>
              <option value="salesYearly">salesYearly</option>
              <% } else if (locals.salesYearly) { %>
              <option value="salesYearly" selected>salesYearly</option>
              <option value="salesToday">salesToday</option>
              <option value="salesWeekly">salesWeekly</option>
              <option value="salesMonthly">salesMonthly</option>
              <% } %> -->
            </select>
          </div>
          <div class="col-md-2 col-6">
            <!-- <input
              type="date"
              id="selectedDate"
              class="form-control"
              value="<%= locals.date ? date : '' %>"
              onchange="dateWiseFilter()"
            /> -->

            <!-- <label for="startDate">Start Date:</label>
        <input type="date" id="startDate" value="=startDate">
        <label for="endDate">End Date:</label>
        <input type="date" id="endDate" value="=endDate">
        <button id="filterButton" class="btn btn-primary text-light mt-1">Filter</button>

          </div>
          <div class="col-lg-6 col-md-6 ms-auto text-md-end">
            <a href="" id="createSalesReport" class="btn btn-primary  text-light mb-2"
              >Generate PDF</a
            >
            <a href="" id="downloadExcelReport" class="btn btn-primary text-light mb-2"
              >Download Excel</a
            >
            <a href="" id="downloadSummary" class="btn btn-primary text-light mb-2"
              >Download Summary</a
            >
          </div> -->
        </div>
      </header>
    </div>


    
  <canvas id="salesChart" width="300" height="200"></canvas>

    
  <script>
    // Sample sales data
    const salesData = <%- JSON.stringify(data) %>;
    // [
    // {_id: '2025-02-14', totalSales: 222,totalDiscount: 0,  totalFinalAmount: 222}, format of coming data
    // ];

    const ctx = document.getElementById('salesChart').getContext('2d');
    let salesChart;

    // const aggregateData = (data, interval) => {
    //   const groupedData = data.reduce((acc, item) => {
    //     const date = new Date(item.date);
    //     let key;
    //     switch (interval) {
    //       case 'weekly':
    //         key = `${date.getFullYear()}-W${Math.ceil((date.getDate() + date.getDay()) / 7)}`;
    //         break;
    //       case 'monthly':
    //         key = `${date.getFullYear()}-${date.getMonth() + 1}`;
    //         break;
    //       case 'yearly':
    //         key = `${date.getFullYear()}`;
    //         break;
    //       default:
    //         key = item.date;
    //     }
    //     if (!acc[key]) {
    //       acc[key] = { totalPrice: 0, discount: 0, finalAmount: 0 };
    //     }
    //     acc[key].totalPrice += item.totalPrice;
    //     acc[key].discount += item.discount;
    //     acc[key].finalAmount += item.finalAmount;
    //     return acc;
    //   }, {});

    //   return Object.keys(groupedData).map(key => ({
    //     date: key,
    //     ...groupedData[key]
    //   }));
    // };

    const updateChart = (salesData) => {
      const labels = salesData.map(entry => entry._id);
      const totalPrice = salesData.map(entry => entry.totalSales);
      const discount = salesData.map(entry => entry.totalDiscount);
      const finalAmount = salesData.map(entry => entry.totalFinalAmount);


     // const aggregatedData = aggregateData(salesData, interval);
      // const labels = salesData.map(entry => entry._id);
      // const totalPrice = salesData.map(entry => entry.totalSales);
      // const discount = salesData.map(entry => entry.totalDiscount);
      // const finalAmount = salesData.map(entry => entry.totalFinalAmount);
     
      
      if (salesChart) {
        salesChart.destroy();
      }

      salesChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Total Price',
              data: totalPrice,
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            },
            {
              label: 'Discount',
              data: discount,
              backgroundColor: 'rgba(255, 159, 64, 0.2)',
              borderColor: 'rgba(255, 159, 64, 1)',
              borderWidth: 1
            },
            {
              label: 'Final Amount',
              data: finalAmount,
              backgroundColor: 'rgba(153, 102, 255, 0.2)',
              borderColor: 'rgba(153, 102, 255, 1)',
              borderWidth: 1
            }
          ]
        },
        options: {
          scales: {
            x: {
              beginAtZero: true,
              type: 'category',
              title: {
                display: true,
                text: 'Date'
              }
            },
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Amount'
              }
            }
          },
          width: 300, 
        height: 200,
        }
      });
    };

    updateChart(salesData); // Initialize with daily data
  </script>

    
    <div class="right mt-5 container">
      <!-- <input type="date" id="calendar" name="calendar" class="form-control mb-3" /> -->
      
    
     
  </section>
</main>




  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>




<%- include("../../views/partials/admin/footer") %>
</div>
